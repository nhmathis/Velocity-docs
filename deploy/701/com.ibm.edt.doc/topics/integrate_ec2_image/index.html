<!DOCTYPE html>
<html lang="en">
<head>
  
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="author" content="UrbanCode">
    <link rel="canonical" href="http://uc-doc-test.s3-website-us-east-1.amazonaws.com/deploy/701/com.ibm.edt.doc/topics/integrate_ec2_image/">
    <link rel="shortcut icon" href="../../../img/favicon.ico">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" />
    <title>Registering Amazon EC2 images with the cloud discovery service - UrbanCode Deploy</title>
    <link href="../../../css/bootstrap-3.3.7.min.css" rel="stylesheet">
    <link href="../../../css/font-awesome-4.7.0.css" rel="stylesheet">
    <link href="../../../css/base.css" rel="stylesheet">
    <link rel="stylesheet" href="../../../css/highlight.css">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

    <script src="../../../js/jquery-3.2.1.min.js"></script>
    <script src="../../../js/bootstrap-3.3.7.min.js"></script>
    <script src="../../../js/highlight.pack.js"></script>
    
    <base target="_top">
    <script>
      var base_url = '../../..';
      var is_top_frame = false;
        
        var pageToc = [
          {title: "Registering Amazon EC2 images with the cloud discovery service", url: "#_top", children: [
          ]},
        ];

    </script>
    <script src="../../../js/base.js"></script> 
</head>

<body>
<script>
if (is_top_frame) { $('body').addClass('wm-top-page'); }
</script>



<div class="container-fluid wm-page-content">
  <a name="_top"></a>
    

    <h1 id="registering-amazon-ec2-images-with-the-cloud-discovery-service">Registering Amazon EC2 images with the cloud discovery service</h1>
<p>To use the blueprint designer to model environments on Amazon Web Services, you must register Amazon Elastic Compute Cloud (EC2) images with the cloud discovery service. EC2 is part of AWS. EC2 provides the virtual nodes in an environment, and other services in AWS provide services such as networking and data storage.</p>
<p>Before you register images, configure the cloud discovery service. See <a href="../../../com.ibm.udeploy.doc/topics/cds_configure/">Setting up images, regions, and flavors for the cloud discovery service and engine</a>.</p>
<ol>
<li>From the EC2 web console, find the ID of the image to register. Image IDs start with <code>ami-</code>, such as <code>ami-abcd1234</code>. You can register virtual images that use a Linux™ or Windows™ operating system.</li>
<li>Open the cloud discovery service configuration file in a text editor. </li>
<li>In the <code>amazon</code> section, find the region for the image, such as <code>us-east-1</code>. </li>
<li>
<p>In the <code>images</code> section, add the image ID to the list of images. For example, the following code from a configuration file includes three image IDs in the <code>us-east-1</code> region.</p>
<p>```
"amazon": {
  "regions": [
    {
      "id": "us-east-1",
      "name": "US East (Northern Virginia)",
      "images": [
        "ami-abcd1234",
        "ami-1234abcd",
        "ami-5678abcd"</p>
<pre><code>  ]
}
</code></pre>
<p>]
},
```</p>
</li>
<li>
<p>In the <code>images</code> section, configure images names that contain asterisks (*) as wildcards. All images that match the name pattern that you specify are displayed in the <strong>Images</strong> palette of the blueprint designer. For example, the following code from a configuration file includes three specific image IDs and five image name patterns in the <code>us-east-1</code> region.</p>
<p><code>"amazon": {
  "regions": [
    {
      "id": "us-east-1",
      "name": "US East (Northern Virginia)",
      "images": [
        "ami-abcd1234",
        "ami-1234abcd",
        "ami-5678abcd"
        "name:RHEL-*HVM*-20*-GP2",
        "name:suse-sles-12-sp*v20*hvm-ssd-x86_64*",
        "name:suse-sles-11-sp4*v20*hvm-ssd-x86_64*",
        "name:ubuntu/images/hvm-ssd/ubuntu-*-amd64-server-2016*",
        "name:Windows_Server-20*English-64Bit-Base-2016*"
      ]
    }
  ]
},</code></p>
</li>
<li>
<p>Save the cloud discovery service configuration file. </p>
</li>
<li>
<p>Register the EC2 instance types that you provision with the cloud discovery service. </p>
<ol>
<li>Back up the /usr/lib/python2.7/site-packages/clouddiscoveryservice/resources/clouds/instance_type_details.py file. For example, you might create a copy of the file and name it instance_type_details.py.old.</li>
<li>Open the instance_type_details.py file. </li>
<li>Find the region to customize, such as <code>us-east-1</code>. </li>
<li>
<p>In the <code>REGION_DETAILS</code> section, add the instance type IDs that you provision to the <code>instance_types</code> section for each region. To review the list of available EC2 instance types, see <a href="https://aws.amazon.com/ec2/instance-types/">Amazon EC2 Instance Types</a>. For example, the following code from the instance_type_details.py file includes three instance types in the <code>us-east-1</code> region.</p>
<p><code>REGION_DETAILS = {
    # US East (Northern Virginia) Region
    'us-east-1': {
        'endpoint': 'ec2.us-east-1.amazonaws.com',
        'api_name': 'ec2_us_east',
        'country': 'USA',
        'signature_version': '2',
        'instance_types': [
            't2.micro',
            'm3.medium',
            'm4.large'   
        ]
    }
}</code></p>
</li>
<li>
<p>In the <code>INSTANCE_TYPES</code> section, add the details for each instance type. Contact AWS support to obtain the instance type details. For example, the following code from the instance_type_details.py file includes details for the <code>t2.micro</code>, <code>m3.medium</code>, and <code>m4.large</code> instance types that are shown in the <code>us-east-1</code> region.</p>
<p><code>INSTANCE_TYPES = {
    't2.micro': {
        'id': 't2.micro',
        'name': 't2.micro (Burstable Performance Micro Instance)',
        'ram': 1024,
        'disk': 0,  # EBS Only
        'bandwidth': None,
        'extra': {
            'cpu': 1
        }
    },
    'm3.medium': {
        'id': 'm3.medium',
        'name': 'm3.medium (Medium Instance)',
        'ram': 3840,
        'disk': 4000,
        'bandwidth': None
    },
    'm4.large': {
        'id': 'm4.large',
        'name': 'm4.large (Large Instance)',
        'ram': 8192,
        'disk': 32000,
        'bandwidth': None
    }
}</code></p>
</li>
</ol>
</li>
<li>
<p>Save the instance_type_details.py file. </p>
</li>
<li>Restart the cloud discovery service. To restart the cloud discovery service, see <a href="../../../com.ibm.udeploy.install.doc/topics/start_patterns/">Starting the blueprint designer, cloud discovery service, and engine</a> and <a href="../../../com.ibm.udeploy.install.doc/topics/stop_patterns/">Stopping the blueprint designer, cloud discovery service, and engine</a>.</li>
</ol>
<p><strong>Parent topic:</strong> <a href="../cloud_connect_amazon/">Connecting to Amazon Web Services</a></p>

  <br>
</div>

<footer class="col-md-12 wm-page-content">
      <p>
        <a href="https://github.com/IBM-UrbanCode/edit/master/docs/com.ibm.edt.doc/topics/integrate_ec2_image.md"><i class="fa fa-github"></i>
Edit on GitHub</a>
      </p>
  <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a> using <a href="https://github.com/gristlabs/mkdocs-windmill">Windmill</a> theme by Grist Labs.</p>
</footer>

</body>
</html>